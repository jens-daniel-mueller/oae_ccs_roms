---
title: "read_data"
author: "Victoria Froh & Jens Daniel MÃ¼ller"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Read this
this is the script to open the data
```{r read_data}

#loading packages
library(ncdf4)
library(tidync)
library(stars)
library(tidyverse)
library(dplyr)

#For the regridded standard files, path:
path_ROMSv2RG_results <- 
 "/net/sea/work/loher/ROMS/Alk_enh_formatted_2024_08/"

#opening specific nc file (Columbia site, 1x)
# nc <- nc_open(paste0(path_ROMSv2RG_results,
#                      "ColumbiaRiver/ColumbiaRiver_2010-2015_1x.nc"))
# 
# print(nc)

#filtering for just one variable w/ stars package
# nc_alk <- read_ncdf(paste0(path_ROMSv2RG_results,
#                      "ColumbiaRiver/ColumbiaRiver_2010-2015_1x.nc"),
#            var = "Alk")

#problem here with Alk and DIC: include the depth dimension; getting weird error
# when trying to slice for this since the value is 0
# nc_surface_alk <- nc_alk %>%
#   filter(depth == 0)

#slicing for just one timepoint
# nc_surface_alk_1 <- nc_surface_alk %>%
#   slice(time, 1)

###################
#using tidync instead
nc <- tidync(paste0(path_ROMSv2RG_results,
                     "ColumbiaRiver/ColumbiaRiver_2010-2015_1x.nc"))

# filtering nc file for just the surface @ the first time index for both 
# DIC and Alk variable
alk_surface_t1 <- nc %>%
  hyper_filter(depth = index == 1, time = index == 1) %>% 
  hyper_tibble(select_var = c("Alk"), #  produces a tibble object
               force = TRUE)
dic_surface_t1 <- nc %>%
  hyper_filter(depth = index == 1, time = index == 1) %>% 
  hyper_tibble(select_var = c("DIC"), # produces a tibble object
               force = TRUE)

#plotting
alk_surface_t1_sf <- st_as_sf(alk_surface_t1, coords = c("lon", "lat"), crs = 4326)
ggplot(data = alk_surface_t1_sf) + geom_sf(aes(color = Alk)) +
  labs(title = "Columbia River Surface Alkalinity @ T1", 
       x = "Longitude", y = "Latitude")

#plotting
dic_surface_t1_sf <- st_as_sf(dic_surface_t1, coords = c("lon", "lat"), crs = 4326)
ggplot(data = dic_surface_t1_sf) + geom_sf(aes(color = DIC)) +
  labs(title = "Columbia River Surface DIC @ T1", 
       x = "Longitude", y = "Latitude")
#why do they look like dots?

##########################
#i tried something else so i could get the data but i can't plot this w/ ggplot
# lon <- ncvar_get(nc, "lon", verbose = FALSE) # read lon variable
# lat <- ncvar_get(nc, "lat", verbose = FALSE) # read lat variable
# time <- ncvar_get(nc, "time", verbose = FALSE) # read t (time) variable
# depth <- ncvar_get(nc, "depth", verbose = FALSE) # read depth variable
# print(c(length(lon), length(lat), length(t), length(depth))) # show vector lengths
# 
# alk_array <- ncvar_get(nc, "Alk") #pull the alk values from the ncdf4 file
# 
# alk_surface_time_1 <- alk_array[, , 1, 1] #pull only the first time point and surface layer


##################
#creating a blank plot and loading in the nc data layer using stars package  
# ggplot(data = alk_surface_time_1) 
#  geom_stars(data = alk_surface_time_1)


# 

```

vhjgvj


```{r plot_data}

```

